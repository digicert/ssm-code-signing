import fs from "fs";
import { getConfigFilePath } from "./utils/services";
import { runWinToolBasedInstallationOrExtraction } from "./runwintools";

export async function installWindowsTools(
  installationPath: string,
  toolToBeUsed: string[],
  usecase: string,
  outputVar:any
): Promise<string> {
  const directoryPath =
    usecase == "gpg-signing"
      ? `${installationPath}//DigiCert One Signing Manager Tools/`
      : `${installationPath}`;
  try {
    fs.mkdirSync(`${directoryPath}`);
  } catch (err) {}

  const extractPath = await runWinToolBasedInstallationOrExtraction(
    toolToBeUsed,
    directoryPath,
    usecase
  );
  
  if (usecase == "gpg-signing") {
    console.log(
      "path where the ssm tools were installed/extracted is ",
      directoryPath
    );
  } else {
    console.log(
      "path where the ssm tools were installed/extracted is ",
      extractPath
    );
  }
  
  outputVar.imp_file_paths["directoryPath"]=directoryPath
  outputVar.imp_file_paths["extractPath"]=extractPath
  
  let configFilePath = "";
  //pkcs11 library installation
  if (usecase != "gpg-signing") {
    const pkcs11FileName = "smpkcs11.dll";
    configFilePath = await getConfigFilePath(pkcs11FileName, extractPath);
  }
  return configFilePath;
}
module.exports = { installWindowsTools };
